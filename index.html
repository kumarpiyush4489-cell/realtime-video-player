<!DOCTYPE html>
<html>
<head>
  <title>Real-time AI Video Player</title>
</head>

<body>

<h2>AI Video Player (Prototype)</h2>

<video id="video" controls width="600">
  <source src="sample.mp4" type="video/mp4">
</video>

<br><br>

<button id="btn">Start Audio Capture</button>

<p id="status">Status: Waiting</p>

<h3>Live Japanese Text:</h3>
<div id="liveText" style="border:1px solid #ccc; padding:10px; width:600px;">
Waiting for speech...
</div>

<h3>Hindi Translation:</h3>
<div id="hindiText" style="border:1px solid #4caf50; padding:10px; width:600px;">
Waiting for translation...
</div>

<script>
const btn = document.getElementById("btn");
const status = document.getElementById("status");
const video = document.getElementById("video");
const liveText = document.getElementById("liveText");
const hindiText = document.getElementById("hindiText");

let recognition;
let lastSpoken = "";

btn.addEventListener("click", async () => {
  if (video.paused) {
    alert("⚠️ Pehle video PLAY karo, phir button dabao");
    return;
  }

  // Lower original volume (demo dubbing effect)
  video.volume = 0.2;

  // Audio Context
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioContext = new AudioContext();
  await audioContext.resume();

  const source = audioContext.createMediaElementSource(video);
  source.connect(audioContext.destination);

  // Speech Recognition
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  recognition = new SpeechRecognition();
  recognition.lang = "ja-JP";
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let transcript = "";
    for (let i = event.resultIndex; i < event.results.length; i++) {
      transcript += event.results[i][0].transcript;
    }

    liveText.innerText = transcript;

    // Demo JP → HI dictionary
    const hindiMap = {
      "こんにちは": "नमस्ते",
      "ありがとう": "धन्यवाद",
      "ドラえもん": "डोरेमॉन",
      "はい": "हाँ",
      "いいえ": "नहीं"
    };

    let translated = transcript;
    Object.keys(hindiMap).forEach(jp => {
      translated = translated.replace(jp, hindiMap[jp]);
    });

    hindiText.innerText = translated;

    // Speak Hindi (avoid repeating same line)
    if (translated && translated !== lastSpoken) {
      speakHindi(translated);
      lastSpoken = translated;
    }
  };

  recognition.start();
  status.innerText =
    "Status: ✅ Audio capture + Japanese STT + Hindi Voice ACTIVE";
});

function speakHindi(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "hi-IN";
  utterance.rate = 1;
  utterance.pitch = 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utterance);
}
</script>

</body>
</html>
